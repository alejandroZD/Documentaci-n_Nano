# Manejo de claves

## Semillas

## Semilla hexadecimal

Las claves privadas de Nano se han derivado tradicionalmente de una cadena hexadecimal mayúscula de 64 caracteres (0 - 9 A - F). Esta es actualmente la forma más popular de semilla respaldada por una variedad de servicios y billeteras. Detalles adicionales están disponibles en la guía de [lo básico](https://docs.nano.org/integration-guides/the-basics/#seed).

## Semilla mnemónica

La(s) clave(s) privada(s) de Nano de derivación mnemónica sigue el estándar BIP[39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) / [44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki). Solo se definen los caminos endurecidos. El [tipo de moneda](https://github.com/satoshilabs/slips/blob/master/slip-0044.md) de Nano es de 165 '(0x800000a5)

 `44'/165'/0'` deriva la primera clave privada, `44'/165'/1'` deriva la segunda clave privada, y así sucesivamente.

Se utiliza el modificador de semilla BIP39 "semilla ed25519", el cual hace que las billeteras sean compatibles entre sí. Esto fue elegido debido a que se utiliza por la implementación de Nano Ledger.

**Ejemplos de demostración**

:warning: **Librerias externas, revisar antes de usar**

Los enlaces de recursos a continuación contienen código relacionado con la gestión de claves privadas y / o la ejecución de transacciones. La Fundación Nano no controla este código, no lo respalda y no es responsable de su uso. El uso de este código requiere revisión y es a su propia discreción.

https://github.com/roosmaa/nano-bip39-demo

https://github.com/joltwallet/bip-mnemonic

**Implementaciones**

https://github.com/numsu/nanocurrency-web-js

**Vectores de prueba**

Franse mnemónica de 24 palabras:

```
edge defense waste choose enrich upon flee junk siren film clown finish luggage leader kid quick brick print evidence swap drill paddle truly occur
```

Frase de contraseña dada:

`some password`

Semilla derivada de BIP39:

```
0dc285fde768f7ff29b66ce7252d56ed92fe003b605907f7a4f683c3dc8586d34a914d3c71fc099bb38ee4a59e5b081a3497b7a323e90cc68f67b5837690310c
```

Clave privada derivada para `44'/165'/0'`:

```
3be4fc2ef3f3b7374e6fc4fb6e7bb153f8a2998b3b3dab50853eabe128024143
```

Clave pública derivada:

```
5b65b0e8173ee0802c2c3e6c9080d1a16b06de1176c938a924f58670904e82c4
```

Dirección derivada:

```
nano_1pu7p5n3ghq1i1p4rhmek41f5add1uh34xpb94nkbxe8g4a6x1p69emk8y1d
```

## Manejo externo

Para sistemas más grandes y más robustos, se recomienda el manejo de la clave privada externa. En esta configuración, el operador del nodo genera y almacena claves privadas en una base de datos externa y solo consulta el nano_node para:

1. Encontrar bloques pendientes para una cuenta
2. Firmar transacciones con una clave privada. Los sistemas más avanzados pueden optar por implementar la firma ellos mismos.
3. Transmitir la transacción firmada a la red.

:pencil: **Nota**

Las [identificaciones de billetera](https://docs.nano.org/integration-guides/the-basics/#wallet-id) no se utilizan para el manejo de clave privada externa ya que las claves privadas no se almacenan en el nano_node. Gran parte de esta sección se basa en la documentación de [especificaciones de los bloques](https://docs.nano.org/integration-guides/the-basics/#blocks-specifications).

## Sistemas externos de contabilidad 

Para implementar adecuadamente los sistemas de contabilidad externos al nodo Nano, se deben implementar las siguientes prácticas, que garantizan que solo se usen bloques completamente confirmados para el seguimiento externo de créditos, débitos, etc.

:fire: **Confirmación e idempotencia**

Los detalles a continuación profundizan sobre esto, pero las dos piezas más importantes de cualquier integración son:

1. **Confirme siempre los bloques** - asegúrese de seguir las recomendaciones de seguimiento de confirmación de bloque para que siempre esté tomando acciones desde bloques confirmados
2. **Garantía de idempotencia** - cada vez que realiza una acción desde una confirmación de bloque, debe ser idempotente para que no vuelva a realizar la acción si se ve el mismo hash de bloque a través del seguimiento de confirmación

**Procedimientos de confirmación de bloques**

Antes de acreditar fondos a una cuenta basada internamente en un depósito en la red, debe confirmarse el bloque que envía los fondos. Esto se hace verificando que la red ha alcanzado el quórum en el bloque. Los detalles del proceso de verificación recomendado se pueden encontrar en la guía de [seguimiento de confirmación de bloque](https://docs.nano.org/integration-guides/block-confirmation-tracking/).

**Seguimiento de balances confirmados**

Los sistemas de contabilidad externa que rastrean los saldos que llegan al nodo deben rastrear los hashes de los bloques que se han recibido para garantizar la idempotencia. Una vez que se ha validado la confirmación de un bloque, se debe registrar el hash del bloque para la cuenta junto con cualquier crédito, débito u otra información relacionada. Para cualquier intento de acreditar o debitar cuentas externas al nodo, se debe verificar que no se haya registrado ninguna actividad conflictiva o duplicada previa para ese mismo hash de bloque.

**Orden de transacción y corrección**

Si está creando un lote de transacciones para una sola cuenta, que puede ser una combinación de envío y recepción de fondos, no es necesario esperar la confirmación de los bloques **en esa cuenta** para crear la próxima transacción. Mientras una transacción sea válida, será confirmada por la red. Las transacciones que siguen solo se pueden confirmar si las transacciones anteriores son válidas.

Sin embargo, siempre debe esperar la confirmación de los **bloques pendientes** antes de crear la transacción de recepción correspondiente, para asegurarse de que se confirme. Siempre espere la confirmación de las transacciones que no creó usted mismo.

## Expandir claves privadas

Una clave privada de Nano es una pieza de datos de 256 bits producida a partir de un generador criptográficamente seguro de números aleatorios .

:zap: **Asegurar claves privadas**

- La generación de claves privadas a partir de una fuente insegura puede provocar la pérdida de fondos.
- Haga una copia de seguridad de cualquier clave privada generada; En caso de pérdida, los fondos de la cuenta quedarán inaccesibles.

:bookmark_tabs: **Paso 1: Generar claves privadas seguras**

El siguiente comando bash genera una clave privada válida a partir de un generador de números aleatorios criptográficamente seguro. Utilice siempre procesos criptográficamente seguros para generar claves privadas.

EJEMPLO DE COMANDO

```
cat /dev/urandom | tr -dc '0-9A-F' | head -c${1:-64}
```

RESULTADO EXITOSO

```
781186FB9EF17DB6E3D1056550D9FAE5D5BBADA6A6BC370E4CBB938B1DC71DA3
```

:bookmark_tabs: **Paso 2: Expandir clave privada**

A partir de la clave privada, se puede derivar una clave pública, y la clave pública se puede traducir a una dirección Nano utilizando el comando RPC [`key_expand`](https://docs.nano.org/commands/rpc-protocol/#key_expand).

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "key_expand",
  "key": "781186FB9EF17DB6E3D1056550D9FAE5D5BBADA6A6BC370E4CBB938B1DC71DA3"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "private": "781186FB9EF17DB6E3D1056550D9FAE5D5BBADA6A6BC370E4CBB938B1DC71DA3",
  "public": "3068BB1CA04525BB0E416C485FE6A67FD52540227D267CC8B6E8DA958A7FA039",
  "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx"
}
```

## Crear transacciones

Al usar claves externas, las transacciones se generan en dos pasos: creación y difusión. Esta sección utilizará más ejemplos que especificaciones precisas.

**Enviar transacción**

:bookmark_tabs: **Paso 1: Obtener información de la cuenta**

Para enviar fondos a una cuenta, primero llame al comando RPC [`account_info`](https://docs.nano.org/commands/rpc-protocol/#account_info) para recopilar la información de cuenta necesaria para elaborar su transacción. Establecer `"representative": "true"` hace que nano_node también devuelva la dirección representante de la cuenta, un dato necesario para crear una transacción.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "account_info",
  "representative": "true",
  "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "frontier": "92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D",
  "open_block": "B292BFFAAE9013BE630B31144EF15205E986940080687C0441CCFE6EAB67FE53",
  "representative_block": "B292BFFAAE9013BE630B31144EF15205E986940080687C0441CCFE6EAB67FE53",
  "balance": "4618869000000000000000000000000",
  "modified_timestamp": "1524626644",
  "block_count": "4",
  "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou"
}
```

:bookmark_tabs: **Paso 2: Crear solicitud `block_create`**

Usando detalles de la respuesta de llamada `account_info`, junto con otra información, podemos crear la solicitud RPC [`block_create`](https://docs.nano.org/commands/rpc-protocol/#block_create).

Para obtener más detalles sobre los valores, consulte la documentación de [especificaciones de bloques](https://docs.nano.org/integration-guides/the-basics/#blocks-specifications).

| Campo              | Valor                                                        |
| :----------------- | :----------------------------------------------------------- |
| `"json_block"`     | siempre `"true"`, para que la salida tenga formato JSON      |
| `"type"`           | Siempre el`"state"` constante                                |
| `"previous"`       | `"frontier"` desde la respuesta de `account_info`            |
| `"account"`        | dirección de `"account"` utilizada en la llamada `account_info` anterior para la que se creará el bloque |
| `"representative"` | dirección `"representative"` devuelta en la llamada `account_info` |
| `"balance"`        | balance de la cuenta en *raw* **luego** de que esta transacción esté completada (decrece si envía, incrementa si recibe). En este ejemplo, enviaremos 1 *nano* (1030*raw*) a la dirección `nano_1q3hqecaw15cjt7thbtxu3pbzr1eihtzzpzxguoc37bj1wc5ffoh7w74gi6p`. |
| `"link"`           | dirección de destino, entre la que se moverán los fondos     |
| `"key"`            | clave privada de la cuenta                                   |

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "block_create",
  "json_block": "true",
  "type": "state",
  "previous": "92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D",
  "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx",
  "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
  "balance": "3618869000000000000000000000000",
  "link": "nano_1q3hqecaw15cjt7thbtxu3pbzr1eihtzzpzxguoc37bj1wc5ffoh7w74gi6p",
  "key": "781186FB9EF17DB6E3D1056550D9FAE5D5BBADA6A6BC370E4CBB938B1DC71DA3"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "hash": "8DB5C07E0E62E9DFE8558CB9BD654A115B02245B38CD369753CECE36DAD13C05",
  "block": {
    "type": "state",
    "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx",
    "previous": "92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D",
    "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
    "balance": "3618869000000000000000000000000",
    "link": "5C2FBB148E006A8E8BA7A75DD86C9FE00C83F5FFDBFD76EAA09531071436B6AF",
    "link_as_account": "nano_1q3hqecaw15cjt7thbtxu3pbzr1eihtzzpzxguoc37bj1wc5ffoh7w74gi6p",
    "signature": "79240D56231EF1885F354473733AF158DC6DA50E53836179565A20C0BE89D473ED3FF8CD11545FF0ED162A0B2C4626FD6BF84518568F8BB965A4884C7C32C205",
    "work": "fbffed7c73b61367"
  }
}
```

:information_source: **Detalles adicionales**

- La opción `json_block`, disponible desde la versión 19.0, hace que la llamada RPC devuelva una versión no bloqueada del bloque, que es más fácil de analizar y siempre se recomienda.
- Los comandos RPC [`block_create`](https://docs.nano.org/commands/rpc-protocol/#block_create) generalmente tardan más que otros comandos RPC porque el nano_nodo tiene que generar la [prueba de trabajo](https://docs.nano.org/integration-guides/the-basics/#proof-of-work) para la transacción. Los datos del bloque de respuesta ya están correctamente formateados para incluir en el comando RPC [`process`](https://docs.nano.org/commands/rpc-protocol/#process).
- El nano_node que crea y firma esta transacción no tiene idea de cuál es el monto de la transacción, ni el estado de la red; todo lo que sabe el nano_node es que está creando un bloque cuyo bloque anterior en la cadena de cuentas tiene el hash `92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D` que da como resultado que la cuenta tenga un saldo de `3618869000000000000000000000000`.
- Si el saldo de la cuenta en el hash de bloque `92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D` era en realidad `5618869000000000000000000000000`, entonces 2 *nano* habrían sido enviados a `nano_1q3hqecaw15cjt7thbtxu3pbzr1eihtzzpzxguoc37bj1wc5ffoh7w74gi6p`.

:question: **¿Qué sucede si recibo fondos en mi cuenta y luego retransmito el envío diseñado anteriormente? ¿Esto resultaría en que envíe fondos excedentes al destinatario?** 

Si siguió esta guía, la respuesta es "no". Cuando emitió el comando RPC [`account_info`](https://docs.nano.org/commands/rpc-protocol/#account_info), recibió el saldo de la cuenta en un hash de bloque específico en su cadena de cuentas. En la transacción creada, especifique ese hash en el campo `"previous"`. Si se ingresaron fondos en la cuenta, el bloque cabecero en la cadena de la cuenta cambiaría. Dado que el envío ya no se refiere al bloqueo en la cadena de la cuenta cuando se transmite, la red rechazará la transacción.

:warning: **Advertencia**

Dado que solo se registra el saldo resultante, el monto de la transacción se interpreta como la diferencia en el saldo del bloque anterior en la cadena de cuentas y el bloque recién creado. Por esta razón, es crucial que obtenga el saldo de la cuenta actual y el bloque cabecero en el mismo comando atomico de RPC [`account_info`](https://docs.nano.org/commands/rpc-protocol/#account_info).

Si no se sigue correctamente esta guía, la siguiente **secuencia inapropiada de eventos podría llevar a cantidades erróneas enviadas** a un destinatario.

1. El saldo de una cuenta, digamos 5 *nano*, se obtuvo usando [`account_balance`](https://docs.nano.org/commands/rpc-protocol/#account_balance). Este saldo es válido a partir del hipotético **BLOCK_A**.
2. Mediante otro proceso controlado por el usuario, se firmó una recepción (**BLOCK_B**) y se transmitió a la cadena de cuenta (condición de carrera).
3. Digamos que este `receive` aumentó los fondos en la cadena de cuentas a 10 *nano*, lo que resulta en un saldo final de 15 *nano*.
4. El bloque *frontier* de la cuenta se obtiene mediante el comando RPC [`accounts_frontiers`](https://docs.nano.org/commands/rpc-protocol/#accounts_frontiers), que devuelve el hash del **BLOCK_B**. Otros metadatos de transacción se obtienen mediante otros comandos RPC.
5. Con los datos recopilados, si se creó una transacción de envío para 3 *nano*, el saldo final se calcularía como 5 − 3 o 2 *nano*.
6. Cuando esto se retransmite, ya que se refiere al bloque principal actual en la cuenta, **BLOCK_B**, la red lo aceptaría. Pero, como el saldo a partir de **BLOCK_B** era en realidad 15 *nano*, esto resultaría en el envío de 12 *nano* al destinatario.

Por este motivo, **solo complete el origen de datos de transacción desde una sola llamada RPC [`account_info`](https://docs.nano.org/commands/rpc-protocol/#account_info)**.

:bookmark_tabs: **Paso 3: Transmite la transacción**

Como resultado del comando anterior, el nano_node devolverá una transacción firmada, pero aún no transmitida. La transmisión de la transacción firmada está cubierta en la sección [transmisión de transacciones](https://docs.nano.org/integration-guides/key-management/#broadcasting-transactions).

**Recibir transacción**

:information_source: **Recibir manualmente el primer bloque**

La primera transacción en una cadena de cuentas, que siempre es una recepción, es ligeramente especial y merece su propia sección [primera transacción de recepción](https://docs.nano.org/integration-guides/key-management/#first-receive-transaction).

:bookmark_tabs: **Paso 1: Obtener información de la cuenta**

Recibir fondos es muy similar a enviar fondos, que se describió en la sección anterior. Se comienza con llamar a `account_info` para obtener detalles del bloque para el *frontier* de la cuenta. El siguiente escenario pretende que nuestro ejemplo anterior de una transacción de envío no se transmitió ni confirmó en la red porque los detalles iniciales de `account_info` son idénticos.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "account_info",
  "representative": "true",
  "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "frontier": "92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D",
  "open_block": "B292BFFAAE9013BE630B31144EF15205E986940080687C0441CCFE6EAB67FE53",
  "representative_block": "B292BFFAAE9013BE630B31144EF15205E986940080687C0441CCFE6EAB67FE53",
  "balance": "4618869000000000000000000000000",
  "modified_timestamp": "1524626644",
  "block_count": "4",
  "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou"
}
```

:bookmark_tabs: **Paso 2: Crear solicitud `block_create`**

Al usar detalles de la respuesta de llamada `account_info`, junto con otra información, podemos crear la solicitud RPC `block_create`. Las dos diferencias entre la transacción de envío son los campos `"link"` y `"balance"`.

Para obtener más detalles sobre los valores, consulte la documentación de [especificaciones de bloques](https://docs.nano.org/integration-guides/the-basics/#blocks-specifications).

| Campo              | Valor                                                        |
| :----------------- | :----------------------------------------------------------- |
| `"json_block"`     | siempre `"true"`, para que la salida tenga formato JSON      |
| `"type"`           | Siempre la contante `"state"`                                |
| `"previous"`       | `"frontier"` de la respuesta de `account_info`               |
| `"account"`        | `"account"` dirección usada en la anterior llamada `account_info` para la que el bloque será creado |
| `"representative"` | Dirección` "representative"` devuelta en la llamada `account_info` |
| `"balance"`        | Saldo de la cuenta en *raw* **después** de completar esta transacción (disminuido si se envía, aumentado si se recibe). En este ejemplo, recibiremos 7 nano (7 × 1030 *raw*) en función de los detalles supuestos del bloque al que se refiere el hash `"link"` (el contenido del bloque no se muestra en este ejemplo). |
| `"link"`           | Hash de bloque de la transacción de envío emparejado, se supone que es un envío de 7 *nano* del hash de bloque `CBC911F57B6827649423C92C88C0C56637A4274FF019E77E24D61D12B5338783` |
| `"key"`            | Llave privada de la cuenta.                                  |

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "block_create",
  "json_block": "true",
  "type": "state",
  "previous": "92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D",
  "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx",
  "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
  "balance": "11618869000000000000000000000000",
  "link": "CBC911F57B6827649423C92C88C0C56637A4274FF019E77E24D61D12B5338783",
  "key": "781186FB9EF17DB6E3D1056550D9FAE5D5BBADA6A6BC370E4CBB938B1DC71DA3"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "hash": "350D145570578A36D3D5ADE58DC7465F4CAAF257DD55BD93055FF826057E2CDD",
  "block": {
    "type": "state",
    "account": "nano_1e5aqegc1jb7qe964u4adzmcezyo6o146zb8hm6dft8tkp79za3sxwjym5rx",
    "previous": "92BA74A7D6DC7557F3EDA95ADC6341D51AC777A0A6FF0688A5C492AB2B2CB40D",
    "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
    "balance": "11618869000000000000000000000000",
    "link": "CBC911F57B6827649423C92C88C0C56637A4274FF019E77E24D61D12B5338783",
    "link_as_account": "nano_3kyb49tqpt39ekc49kbej51ecsjqnimnzw1swxz4boix4ctm93w517umuiw8",
    "signature": "EEFFE1EFCCC8F2F6F2F1B79B80ABE855939DD9D6341323186494ADEE775DAADB3B6A6A07A85511F2185F6E739C4A54F1454436E22255A542ED879FD04FEED001",
    "work": "c5cf86de24b24419"
  }
}
```

:information_source: **Detalles adicionales**

Aquí ocurre el siguiente escenario:

- El balance previo era de  4618869000000000000000000000000  *raw*
- Incremento el balance por  7000000000000000000000000000000  *raw*
- El balance final fue de  11618869000000000000000000000000  *raw*

:bookmark_tabs: **Paso 3: Transmitir la transacción**

Como resultado del comando anterior, el nano_node devolverá una transacción firmada, pero aún no transmitida. La transmisión de la transacción firmada se cubre en la sección [transmisión de transacciones](https://docs.nano.org/integration-guides/key-management/#broadcasting-transactions).

**Primera transacción de recibir**

La primera transacción de una cuenta está diseñada de una manera ligeramente diferente. Para abrir una cuenta, debe haberle enviado algunos fondos con una [transacción de envío](https://docs.nano.org/integration-guides/key-management/#send-transaction) desde otra cuenta. Los fondos estarán pendientes en la cuenta receptora. Si ya conoce el hash de la transacción pendiente, puede omitir el paso 1.

:bookmark_tabs: **Paso 1: Obtener el hash de bloque de la transacción pendiente**

Comience por obtener una lista de transacciones pendientes en la cuenta sin abrir. Limite la respuesta a la transacción de mayor valor utilizando una combinación de `sorting` y `count`.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "pending",
  "account": "nano_1rawdji18mmcu9psd6h87qath4ta7iqfy8i4rqi89sfdwtbcxn57jm9k3q11",
  "count": "1",
  "sorting": "true",
  "include_only_confirmed": "true"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
    "blocks": {
        "5B2DA492506339C0459867AA1DA1E7EDAAC4344342FAB0848F43B46D248C8E99": "100"
    }
}
```

:bookmark_tabs: **Paso 2: Crear solicitud `block_create`**

Al usar el hash de bloque y el monto de la transacción sin procesar de la respuesta de llamada `pending`, junto con otra información, se puede crear la solicitud RPC [`block_create`](https://docs.nano.org/commands/rpc-protocol/#block_create). La única diferencia entre las transacciones de recepción normales es el campo `"previous"`.

Para obtener más detalles sobre los valores, consulte la documentación de [especificaciones de bloques](https://docs.nano.org/integration-guides/the-basics/#blocks-specifications).

| Campo              | Valor                                                        |
| :----------------- | :----------------------------------------------------------- |
| `"json_block"`     | Siempre `"true"`, para que la salida tenga formato JSON      |
| `"type"`           | Siempre la constante`"state"`                                |
| `"previous"`       | Siempre la constante "0" ya que esta solicitud es para el primer bloque de la cuenta |
| `"account"`        | Dirección`"account"` usada en la anterior llamada `account_info` para la que el bloque será creado |
| `"representative"` | Dirección de la cuenta `"representative"` para usar como representante de la cuenta. Elija un representante digno de confianza. |
| `"balance"`        | Saldo de la cuenta en *raw* **después** de completar esta transacción. En este ejemplo, recibiremos 100 *raw*, según los detalles asumidos de la respuesta `"pending"` anterior. |
| `"link"`           | Bloque hash de la transacción de envío emparejado, en este caso se supone que es el bloque `5B2DA492506339C0459867AA1DA1E7EDAAC4344342FAB0848F43B46D248C8E99` |
| `"key"`            | Clave privada de la cuenta                                   |

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "block_create",
  "json_block": "true",
  "type": "state",
  "previous": "0",
  "account": "nano_1rawdji18mmcu9psd6h87qath4ta7iqfy8i4rqi89sfdwtbcxn57jm9k3q11",
  "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
  "balance": "100",
  "link": "5B2DA492506339C0459867AA1DA1E7EDAAC4344342FAB0848F43B46D248C8E99",
  "key": "0ED82E6990A16E7AD2375AB5D54BEAABF6C676D09BEC74D9295FCAE35439F694"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "hash": "ED3BE5340CC9D62964B5A5F84375A06078CBEDC45FB5FA2926985D6E27D803BB",
  "block": {
    "type": "state",
    "account": "nano_1rawdji18mmcu9psd6h87qath4ta7iqfy8i4rqi89sfdwtbcxn57jm9k3q11",
    "previous": "0000000000000000000000000000000000000000000000000000000000000000",
    "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
    "balance": "100",
    "link": "5B2DA492506339C0459867AA1DA1E7EDAAC4344342FAB0848F43B46D248C8E99",
    "link_as_account": "nano_1psfnkb71rssr34sisxc5piyhufcrit68iqtp44ayixnfnkas5nsiuy58za7",
    "signature": "903991714A55954D15C91DB75CAE2FBF1DD1A2D6DA5524AA2870F76B50A8FE8B4E3FBB53E46B9E82638104AAB3CFA71CFC36B7D676B3D6CAE84725D04E4C360F",
    "work": "08d09dc3405d9441"
  }
}
```

:bookmark_tabs: **Paso 3: Transmitir la transacción**

Como resultado del comando anterior, el nano_node devolverá una transacción firmada, pero aún no emitida. La transmisión de la transacción firmada se cubre en la sección [transmitir transacciones](https://docs.nano.org/integration-guides/key-management/#broadcasting-transactions).

## Transmitir transacciones

:bookmark_tabs: **Transmitir mediante el comando RPC `process`**

La necesidad de transmitir a la red el bloque completado es común en todas estas transacciones. Esto se logra mediante el comando RPC [`process`](https://docs.nano.org/commands/rpc-protocol/#process) que acepta el bloque como datos JSON en cadena. Si siguió los ejemplos anteriores, utilizó la opción `json_block` para el RPC [`block_create`](https://docs.nano.org/commands/rpc-protocol#block_create), que le permite usar la versión no encadenada, siempre que incluya la misma opción en esta llamada RPC.

Una transmisión exitosa devolverá el hash del bloque transmitido.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "process",
  "json_block": "true",
  "block": {
    "type": "state",
    "account": "nano_1rawdji18mmcu9psd6h87qath4ta7iqfy8i4rqi89sfdwtbcxn57jm9k3q11",
    "previous": "0000000000000000000000000000000000000000000000000000000000000000",
    "representative": "nano_1stofnrxuz3cai7ze75o174bpm7scwj9jn3nxsn8ntzg784jf1gzn1jjdkou",
    "balance": "100",
    "link": "5B2DA492506339C0459867AA1DA1E7EDAAC4344342FAB0848F43B46D248C8E99",
    "link_as_account": "nano_1psfnkb71rssr34sisxc5piyhufcrit68iqtp44ayixnfnkas5nsiuy58za7",
    "signature": "903991714A55954D15C91DB75CAE2FBF1DD1A2D6DA5524AA2870F76B50A8FE8B4E3FBB53E46B9E82638104AAB3CFA71CFC36B7D676B3D6CAE84725D04E4C360F",
    "work": "08d09dc3405d9441"
  }
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{ 
  "hash": "42A723D2B60462BF7C9A003FE9A70057D3A6355CA5F1D0A57581000000000000"
}
```

:fire: **Use el subtipo de bloque como un control de validez**

Desde la versión 18.0, [`process`](https://docs.nano.org/commands/rpc-protocol/#process) tiene una cadena opcional `"subtype"`, que toma el valor de enviar / recibir / abrir / cambiar. Este campo se puede usar para evitar realizar una operación no deseada con un bloque, ya que la solicitud devolverá un error si los detalles del bloque no coinciden con el `"subtype"` proporcionado.

:fire: **Observación del bloque y retrabajo**

Desde la versión 20.0, los bloques procesados mediante `process` se ponen bajo observación por el nodo para retransmitir y volver a generar el trabajo en determinadas condiciones. Si desea desactivar esta función, agregue `"watch_work": "false"` al comando RPC de proceso.

- Si no se confirma un bloque dentro de un cierto período de tiempo (opción de configuración `work_watcher_period`, 5 segundos por defecto), puede ocurrir una regeneración automática de una prueba de trabajo de mayor dificultad.
- La regeneración solo tiene lugar cuando la red no puede confirmar las transacciones rápidamente (comúnmente se conoce como saturación de la red) y la prueba de trabajo de mayor dificultad se utiliza para ayudar a priorizar el bloque más alto en la cola de procesamiento de otros nodos.
- La opción de configuración `max_work_generate_multiplier` se puede usar para limitar la cantidad de esfuerzo que se debe gastar para volver a generar la prueba de trabajo.
- El umbral de dificultad que se tiene como objetivo de la prueba de trabajo se obtiene internamente como el mínimo entre [`active_difficulty`](https://docs.nano.org/commands/rpc-protocol/#active_difficulty) y `max_work_generate_multiplier` (convertido en dificultad).
- Con una nueva prueba de trabajo de [mayor dificultad](https://docs.nano.org/integration-guides/the-basics/#difficulty-multiplier), el bloque tendrá mayor prioridad de confirmación en toda la red.

:information_source: **Cuando una transacción no se confirma**

- Si una transacción tarda demasiado en confirmarse, puede llamar al comando RPC [`process`](https://docs.nano.org/commands/rpc-protocol/#process) con los mismos datos de bloque sin riesgo.
- Si por alguna razón una transacción no se transmite correctamente, las transacciones posteriores en la cadena de la cuenta después de esa transacción no serán aceptadas por la red ya que el campo `"previous"` en los datos de la transacción se refiere a un bloque no existente.
- Si se produce esta situación, la retransmisión de las transacciones faltantes hará que los bloques posteriores sean válidos en el libro mayor de la red.

:bookmark_tabs: **Retransmitir bloques para una cadena de cuenta**

El siguiente comando retransmite todos los hashes en una cadena de cuenta que **comienza** en el hash de bloque proporcionado:

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "republish",
  "hash": "48006BF3146C18CAD3A53A957BF64EF7C57820B21FCCE373FA637559DA260358"
}' http://127.0.0.1:7076
```

## Manejo interno

El software nano_node tiene un administrador de clave privada incorporado que es adecuado para operaciones más pequeñas (<1000 cuentas). El [manejo de claves externas](https://docs.nano.org/integration-guides/key-management/#external-management) permite sistemas más potentes y robustos a costa de una complejidad adicional. el manejo de claves externas se recomienda para operaciones más grandes.

## Crear una billetera

Para crear una cuenta, primero debe crear una billetera para guardar la semilla que posteriormente creará la cuenta.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "wallet_create"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{ 
  "wallet": "E3E67B1B3FFA46F606240F1D0B964873D42E9C6D0B7A0BF376A2E128541CC446"
}
```

El nano_node responde con la identificación de billetera. Si la pierde, solo se puede recuperar mediante un comando CLI. Para reiterar, **la identificación de billetera no es una semilla**. La semilla se puede extraer para hacer una copia de seguridad en [copia de seguridad de semilla](https://docs.nano.org/integration-guides/key-management/#backing-up-seed). Muchos de los comandos RPC en esta guía requieren la identificación de billetera.

## Recuperar la identificación de billetera

Si pierde su identificación de billetera, puede imprimir todas sus identificaciones de billetera y direcciones públicas en esas billeteras con el comando [`--wallet_list`](https://docs.nano.org/commands/command-line-interface/#-wallet_list) CLI de la siguiente manera:

FORMATO DEL COMANDO

```
docker exec ${NANO_NAME} nano_node --wallet_list
```

RESPUESTA EXITOSA

```
Wallet_ID: E3E67B1B3FFA46F606240F1D0B964873D42E9C6D0B7A0BF376A2E128541CC446
nano_16odwi933gpzmkgdcy9tt5zef5ka3jcfubc97fwypsokg7sji4mb9n6qtbme
Wallet_ID: DB0711484E35A4C75230D898853A86BFAFE9F87FCE99C83A4C2668C39607DD4B
```

En este ejemplo, el sistema interno de manejo de clave privada del nano_node contiene dos billeteras, cada una con una semilla diferente de 256 bits. La primera billetera tiene una sola cuenta y la segunda billetera tiene cero cuentas. La creación de cuenta se cubrirá más adelante.

## Respaldar semilla

El siguiente comando imprimirá la semilla de una billetera dada para stdout. Reemplace `$ {WALLET_ID}` con la identificación de billetera que le gustaría que muestre la semilla.

FORMATO DEL COMANDO

```
docker exec ${NANO_NAME:-nano_node_1} nano_node --wallet_decrypt_unsafe --wallet ${WALLET_ID}
```

RESPUESTA EXITOSA

```
Seed: D56143E7561D71C1AF4D563C6AF79EECE93E82479818AD8ED88BED1AAE8BE4E5
Pub: nano_16odwi933gpzmkgdcy9tt5zef5ka3jcfubc97fwypsokg7sji4mb9n6qtbme
Prv: 1F6FEB5D1E05C10B904E1112F430C3FA93ACC7067206B63AD155199501794E3E
```

:information_source: **Información**

El nano_node responde con tres piezas de información:

- Semilla de la wallet (hagale un respaldo).
- Dirección pública de emparejamiento.
- Clave privada (derivada determinísticamente de la semilla) de cuentas dentro de la billetera.

Notas adicionales:

- Si el usuario cambia la semilla en una billetera, las futuras cuentas creadas se derivarán de esa semilla.
- Cambiar semillas en una wallet que ya tenga cuentas puede causar una pérdida accidental de fondos debido a una semilla o copia de seguridad de clave privada incorrecta.
- Se recomienda crear siempre una billetera nueva al restaurar una semilla.

RESPUESTA DE ERROR

```
Wallet doesn't exist
```

:warning: **Advertencia**

Si alguien tiene acceso a la semilla, puede acceder libremente a los fondos, así que manténgala muy segura. Dado que el comando anterior se imprime en stdout, se recomienda borrar stdout luego usando:

```
clear && printf '\e[3J'
```

## Restaurar / Cambiar Semilla

:warning: **Advertencia**

Solo cambie la semilla de una billetera que no contiene cuentas. Cambiar la semilla de una billetera que ya tiene cuentas puede conducir a una falsa sensación de seguridad: las cuentas son generadas por la semilla que está actualmente en la billetera. Generar cuentas, luego cambiar la semilla y hacer una copia de seguridad de la nueva semilla no respalda las cuentas generadas previamente.

FORMATO DE SOLICITUD

```
curl -d '{
  "action": "wallet_change_seed",
  "wallet": "<WALLET_ID>",
  "seed": "<SEED>"
}' http://127.0.0.1:7076
```

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action":"wallet_change_seed",
  "wallet":"DB0711484E35A4C75230D898853A86BFAFE9F87FCE99C83A4C2668C39607DD4B",
  "seed":"D56143E7561D71C1AF4D563C6AF79EECE93E82479818AD8ED88BED1AAE8BE4E5"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "success": ""
}
```

RESPUESTA DE ERROR

Respuesta si la identificación de billetera no se encuentra en el nano_node:

```
{
  "error": "Wallet not found"
}
```

Respuesta si el campo de la semilla contiene valores no hexadecimales o es muy largo:

```
{ 
  "error": "Bad seed"
}
```

:warning: **Advertencia**

Si la semilla hexadecimal representa menos de 256 bits, la semilla se rellenará con 0 a la izquierda para convertirse en 256 bits.

## Crear cuenta

Después de crear una billetera, su identificación correspondiente, y **hacer una copia de seguridad de la semilla (no de la identificación de billetera)**, la billetera se puede llenar con cuentas. Para crear una nueva cuenta en una billetera, use el comando [`account_create`](https://docs.nano.org/commands/rpc-protocol/#account_create) RPC:

FORMATO DE SOLICITUD

```
curl -d '{
  "action": "account_create",
  "wallet": "<WALLET_ID>"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{ 
  "account": "nano_16odwi933gpzmkgdcy9tt5zef5ka3jcfubc97fwypsokg7sji4mb9n6qtbme"
}
```

RESPUESTA DE ERROR

```
{
  "error": "Wallet not found"
}
```

## Crear cuentas masivas

Para generar muchas cuentas en masa, es más eficiente crearlas de una vez al usar el comando RPC [`accounts_create`](https://docs.nano.org/commands/rpc-protocol/#accounts_create):

FORMATO DE SOLICITUD

```
curl -d '{
    "action": "accounts_create",
    "wallet": "<WALLET_ID>",
    "count": "<NUM_ACCOUNTS>"
}' http://127.0.0.1:7076
```

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "accounts_create",
  "wallet": "DB0711484E35A4C75230D898853A86BFAFE9F87FCE99C83A4C2668C39607DD4B",
  "count":"5"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "accounts": [
    "nano_35kgi43t5hgi64715qnppmz1yb6re1igfcrkfx4ppirkqpfmecnpd1mdmafu",
    "nano_3t13y6b7h93yn9hehn8p6yqx1yqzrxxs33drhzep8huhymwxamn15pba75oj",
    "nano_11exxzfoosai96w7gnrjrn7m6i8bodch37ib8jgxsm5k96na6e1wda8np881",
    "nano_3xbsso8pkemwatwdnkcyn1bfcmrb8dpcg3pit9zqxj9mkxa6ifiankff6m9x",
    "nano_1q5gpy46moe1csj8md8oq3x57sxqmwskk8mmr7c63q1yebnjcsxg1yib19kn"
  ]
}
```

## Recibir fondos

Mientras el nano_node esté sincronizado y desbloqueado (el bloqueo de nano_node no se cubre en esta guía), el nano_node crea y firma automáticamente transacciones de recepción para todas las cuentas en el sistema interno de manejo de clave privada de la billetera.

:fire: **Tip**

En el caso de que una recepción no se genere automáticamente, se puede generar manualmente utilizando el comando RPC [`receive`](https://docs.nano.org/commands/rpc-protocol/#receive).

**Recibir fondos de manera semimanual**

Si el nano_node no inicia sesión automáticamente en una transacción pendiente, las transacciones se pueden iniciar manualmente. La forma más fácil es ordenar explícitamente al nano_node que verifique todas las cuentas en todas sus billeteras en busca de bloques pendientes.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "search_pending_all"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "success": ""
}
```

:pencil: **Nota**

A medida que aumenta el número de cuentas en un nano_node, este comando se vuelve cada vez más costoso desde el punto de vista computacional.

## Enviar fondos

El comando RPC [`send`](https://docs.nano.org/commands/rpc-protocol#send) envía fondos desde una cuenta en la billetera especificada a una dirección de destino.

FORMATO DE SOLICITUD

```
curl -d '{
  "action": "send",
  "wallet": "<WALLET_ID>",
  "source": "<SOURCE_ADDRESS>",
  "destination": "<DESTINATION_ADDRESS>",
  "amount": "1000000",
  "id": "7081e2b8fec9146e"
}' http://127.0.0.1:7076
```

| Campo       | Descripción                                                  |
| :---------- | :----------------------------------------------------------- |
| wallet      | Identificación de billetera que contiene la dirección de origen |
| source      | Dirección controlada por el usuario que comienza con "nano_" |
| destination | Dirección de destino que comienza con "nano_"                |
| amount      | Cantidad a enviar expresada en *raw*                         |
| id          | Cualquier cadena                                             |

:warning: **Importante**

El campo `"id"`es un mecanismo de seguridad que evita la emisión de una transacción varias veces al repetir el comando RPC.

- Si una transacción es exitosa, el comando nano_node ignorará cualquier comando RPC [`send`](https://docs.nano.org/commands/rpc-protocol/#send) posterior con el mismo identificador.
- Si se agota el tiempo de la solicitud, el envío puede o no haber pasado.
- La mayoría de los problemas de "retiro doble" de las casas de cambio son causados por ingenuas rutinas de manejo de errores que vuelven a emitir la solicitud de envío sin el parámetro `"id"`.
- El campo `"id"` es local para la instancia nano_node del usuario y no ofrece protección cuando se envía a diferentes instancias del nano_node que manejan la misma semilla.
- Como se mencionó anteriormente, se desaconseja tener una semilla cargada en múltiples nano_node en línea.
- Si maneja más de mil cuentas, se recomienda trabajar en un sistema separado para manejar claves y cuentas externamente.

A continuación un comando de muestra para enviar 1 *nano* desde `nano_3e3j5tkog48pnny9dmfzj1r16pg8t1e76dz5tmac6iq689wyjfpi00000000` a `nano_16odwi933gpzmkgdcy9tt5zef5ka3jcfubc97fwypsokg7sjibmb9n6`.

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "send",
  "wallet": "000D1BAEC8EC208142C99059B393051BAC8380F9B5A2E6B2489A277D81789F3F",
  "source": "nano_3e3j5tkog48pnny9dmfzj1r16pg8t1e76dz5tmac6iq689wyjfpi00000000",
  "destination": "nano_16odwi933gpzmkgdcy9tt5zef5ka3jcfubc97fwypsokg7sji4mb9n6qtbme",
  "amount": "1000000000000000000000000000000",
  "id": "7081e2b8fec9146e"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{ 
  "block": "000D1BAEC8EC208142C99059B393051BAC8380F9B5A2E6B2489A277D81789F3F"
}
```

En caso de éxito, el nano_node devuelve el hash del bloque de la transacción.

## Volver a publicar transacciones

La transacción puede tardar unos segundos en aparecer en la red de Nano. Si la transacción no aparece, puede llamar al comando RPC [`republish`](https://docs.nano.org/commands/rpc-protocol/#republish) con el hash de la transacción faltante más antigua. Las cadenas de cuentas **deben ser continuas e ininterrumpidas**. Si por alguna razón una transacción no se transmite correctamente, la red no aceptará las transacciones posteriores en la cadena de cuentas, ya que el campo `"previous"` en los datos de la transacción se refiere a un bloque desconocido para otros nodos de la red.

:fire: **Tip**

Volver a publicar las transacciones faltantes hará que todos los bloques posteriores sean válidos en el libro mayor de la red. Volver a publicar no crea nuevas transacciones.

El siguiente comando retransmite todos los hashes en una cadena de cuentas que comienzan en bloque con el hash `$ {BLOCK HASH}`:

EJEMPLO DE SOLICITUD

```
curl -d '{
  "action": "republish",
  "hash": "AF9C1D46AAE66CC8F827904ED02D4B3D95AA98B1FF058352BA6B670BEFD40231"
}' http://127.0.0.1:7076
```

RESPUESTA EXITOSA

```
{
  "success": "",
  "blocks": [
    "AF9C1D46AAE66CC8F827904ED02D4B3D95AA98B1FF058352BA6B670BEFD40231",
    "C9A111580A21F3E63F2283DAF6450D5178BFAC2A6C38E09B76EEA9CE37EC9CE0"
  ]
}
```

En caso de éxito, el nano_node devuelve los hashes de todos los bloques republicados.